//-
	Admin member management page. Can edit details for any individual member
	 or delete members or create a new one.
	PARAM
		members		[Object Array]	From db.teammembers
	CALLED BY
		teammembers.js '/admin/teammembers/'
	//
extends ../layout
block content
	div(class="w3-container")
		h3=title
		div(class="w3-row")
			div(class="w3-col m3 w3-padding-small") Actions
			div(class="w3-col m3 w3-padding-small") Name
			div(class="w3-col m2 w3-padding-small") Subteam
			div(class="w3-col m2 w3-padding-small") Class
			div(class="w3-col m2 w3-padding-small") Years on Team
		each member in members
			div(class="w3-row")
				div(class="w3-col s12 m0")
					p(class="theme-spacer")
				form(id=`deleteMember${member._id}` action="/admin/teammembers/deletemember" method="post")
					input(type="hidden" name="memberId" value=member._id)
				div(class="w3-col s5 m1 w3-padding-small")
					//-2019-09-26 JL: Added str.replace to member.name in case there are apostrophes in the name
					button(class="w3-btn theme-red w3-block" style="padding: 8px 0px" onclick=`confirmDelete("${member.name}", "${member._id}")`) Delete
				//-updateMember submits to javascript func.
				form(id=`updateMember${member._id}` action=`javascript:updateMember('${member._id}')` method="post")
					input(type="hidden" name="memberId" value=member._id)
					div(class="w3-col s7 m2 w3-padding-small")
						button(class="w3-btn theme-submit w3-block" type="submit") Update
					div(class="w3-col m3 w3-padding-small")
						input(type="text" value=member.name name="name" class="w3-input theme-input w3-no-border theme-inline-padding")
					div(class="w3-col m2 w3-padding-small")
						select(class="w3-select theme-input w3-no-border" name="subteam_key")
							//- 2019-9-26 JL: Now cycles through configured member "subteam" names, and gives options based on the configuration.
							- subteams = config.subteams;
							each option in subteams
								- if (member.org_info.subteam_key == option.subteam_key)
									option(value=option.subteam_key selected)= option.label
								- else
									option(value=option.subteam_key)= option.label
					div(class="w3-col m2 w3-padding-small")
						select(class="w3-select theme-input w3-no-border" name="class_key")
							//- 2019-9-26 JL: Now cycles through configured member "class" names, and gives options based on the configured class names.
							- classes = config.classes;
							each option in classes
								- if (member.org_info.class_key == option.class_key)
									option(value=option.class_key selected)= option.label
								- else
									option(value=option.class_key)= option.label
					div(class="w3-col m2 w3-padding-small")
						input(type="text" value=member.org_info.years name="years" class="w3-input theme-input w3-no-border theme-inline-padding")
		div(class="w3-row")
			form(action="/admin/teammembers/addmember" method="post")
				div(class="w3-col m2 w3-padding-small")
					button(type="submit" class="w3-btn theme-submit w3-block") Add
				div(class="w3-col m3 w3-padding-small")
					input(type="text" class="w3-input theme-input w3-block w3-no-border theme-inline-padding" name="name" placeholder="name")
				div(class="w3-col m2 w3-padding-small")
					select(name="subteam" class="w3-select theme-input w3-no-border")
						- subteams = config.subteams;
						each option in subteams
							option(value=option.subteam_key)= option.label
				div(class="w3-col m3 w3-padding-small")
					select(name="className" class="w3-select theme-input w3-no-border")
						- classes = config.classes;
						each option in classes
							option(value=option.class_key)= option.label
				div(class="w3-col m2 w3-padding-small")
					input(class="w3-input theme-input w3-no-border theme-inline-padding" name="years" type="number" placeholder="years on team")
	script.
		function confirmDelete(memberName, memberId){
			if(confirm('Delete member: "' + memberName + '"?')){
				console.log($("#deleteMemberForm"+ memberId))
				$("#deleteMember"+ memberId).submit();
			}
		}
		function updateMember( memberId ){
			
			var memberForm = $(`#updateMember${memberId}`);
			
			var memberFormContents = memberForm.serialize();
			
			$.post( '/admin/teammembers/updatemember', memberFormContents, function(response){
				
				//This is the page-determined response status code
				switch( response.status ){
					case 403:
						createNotificationCard("Sorry, you are not authorized to edit this user.", "bad");
						break;
					case 200:
						createNotificationCard("Updated member successfully.", )
				}
			})
		}